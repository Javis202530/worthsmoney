<!DOCTYPE html>
<html lang="en">
  
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | WorthMoney Investment</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <script>
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user) {
    window.location.href = "auth.html";
  }
</script>


<!-- ===== TOP BAR ===== -->
<header class="topbar">
  <div class="brand">WorthMoney <span>Investment</span></div>
  <nav class="dash-nav">
    <a href="dashboard.html">Dashboard</a>
    <a href="wallet.html">Deposit</a>
    <a href="transactions.html">Transactions</a>
    <a href="index.html">Logout</a>
  </nav>
</header>

<!-- ===== DASHBOARD ===== -->
<section class="dashboard">
  <h2>Welcome, Investor</h2>
  <p class="muted">Account overview and daily returns</p>

  <!-- ===== STATS ===== -->
  <div class="stats-grid">

    <div class="stat-card">
      <h3 id="balanceAmount">$0.00</h3>
      <p>Account Balance</p>
    </div>

    <div class="stat-card">
      <h3 id="activeCount">0</h3>
      <p>Active Investments</p>
    </div>

    <div class="stat-card">
      <h3 id="dailyRoi">—</h3>
      <p>Daily ROI</p>
    </div>

    <div class="stat-card">
      <h3 id="totalEarnings">$0.00</h3>
      <p>Total Earnings</p>
    </div>

  </div>

  <!-- ===== ACTIONS ===== -->
  <div class="dashboard-actions">
    <button onclick="location.href='wallet.html'">Deposit Funds</button>
    <button class="secondary" onclick="location.href='wallet.html'">Withdraw Funds</button>
    <a href="#" onclick="logout()">Logout</a>

  </div>

  <!-- ===== INVESTMENTS ===== -->
  <h3>My Investments</h3>
  <div id="investmentList"></div>

</section>

<!-- ===== FOOTER ===== -->
<footer class="footer-pro">
  © 2025 WorthMoney Investment
</footer>

<!-- ===== DASHBOARD SCRIPT ===== -->
<script>
  function loadDashboard() {
    let investments = JSON.parse(localStorage.getItem('investments')) || [];
    let balance = parseFloat(localStorage.getItem('balance')) || 0;
    const today = new Date().toLocaleDateString();

    let activeCount = 0;
    let totalEarned = 0;
    let roiRate = 0;
    let updated = false;

    investments = investments.map(inv => {
      if (inv.status === 'Active') {
        activeCount++;
        roiRate = inv.rate;

        if (inv.lastRoiDate !== today) {
          const profit = inv.amount * inv.rate;
          inv.totalEarned = (inv.totalEarned || 0) + profit;
          inv.lastRoiDate = today;
          balance += profit;
          updated = true;
        }
      }
      totalEarned += inv.totalEarned || 0;
      return inv;
    });

    if (updated) {
      localStorage.setItem('investments', JSON.stringify(investments));
      localStorage.setItem('balance', balance.toFixed(2));
    }

    // ===== UI UPDATE =====
    document.getElementById('balanceAmount').textContent = `$${balance.toFixed(2)}`;
    document.getElementById('activeCount').textContent = activeCount;
    document.getElementById('dailyRoi').textContent =
      activeCount > 0 ? `${(roiRate * 100).toFixed(2)}%` : '—';
    document.getElementById('totalEarnings').textContent = `$${totalEarned.toFixed(2)}`;

    renderInvestments(investments);
  }

  function renderInvestments(investments) {
    const list = document.getElementById('investmentList');
    list.innerHTML = '';

    if (investments.length === 0) {
      list.innerHTML = '<p>No investments yet</p>';
      return;
    }

    investments.forEach(inv => {
      list.innerHTML += `
        <div class="stat-card">
          <strong>Amount:</strong> $${inv.amount}<br>
          <strong>Rate:</strong> ${(inv.rate * 100).toFixed(2)}% daily<br>
          <strong>Earned:</strong> $${(inv.totalEarned || 0).toFixed(2)}<br>
          <strong>Status:</strong> ${inv.status}
        </div>
      `;
    });
  }

  loadDashboard();
</script>
<script>
  function logout() {
    // remove logged-in user
    localStorage.removeItem("user");

    // OPTIONAL: also clear admin flag if any
    localStorage.removeItem("isAdmin");
    localStorage.removeItem("adminExpiry");

    // redirect to home page
    window.location.href = "index.html";
  }
</script>

</body>
</html>



